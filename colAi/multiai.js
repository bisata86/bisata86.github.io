function changeGridDim(){$(window).width()>$(window).height()?($("body").addClass("landscape"),$("body").removeClass("portrait")):($("body").removeClass("landscape"),$("body").addClass("portrait"))}$(document).ready(function(){ga("create","UA-56086246-1","auto"),ga("send","pageview"),changeGridDim()}),window.fbAsyncInit=function(){FB.init({appId:"866370050124335",xfbml:!0,version:"v2.4"})},function(e,t,n){var a,i=e.getElementsByTagName(t)[0];e.getElementById(n)||(a=e.createElement(t),a.id=n,a.src="//connect.facebook.net/en_US/sdk.js",i.parentNode.insertBefore(a,i))}(document,"script","facebook-jssdk"),$(window).on("orientationchange",function(){changeGridDim()}),$(function(){function e(e){"win"==e&&(A++,A%2==0?T=3:(T=2,y+=3)),k=100/y+"%",O=[],G=[],D=[],q="<div class='pixel'></div>",B="";for(var t=0;y>t;t++)for(var n=0;y>n;n++)B+=q;$("#grid").html(""),$("#grid").append(B),m(),d(),g(),changeGridDim(),c(),$("body").removeClass("gameover"),changeGridDim(),$("body").addClass("gaming"),$("#levelcounter").html(""+A),O.push(x[0][y-1]),G.push(x[y-1][0]),2!=T&&D.push(x[0][0]),$(".power").attr("class","power"),$("#powers").removeClass("wait")}function t(){var e,t=Math.floor(6*Math.random()+1);return 1==t&&(e="green"),2==t&&(e="yellow"),3==t&&(e="red"),4==t&&(e="blue"),5==t&&(e="violet"),6==t&&(e="orange"),e}function n(e,n){var a,o=0,s=[];if(1==n&&(s=D),2==n&&(s=G,$("#powers").removeClass("wait")),2==T&&(s=["cane",0,0]),2==T&&(s[0][0]="fake"),2==T&&$("#powers").removeClass("wait"),$(".power").each(function(){if($(this).attr("id")!=O[0][0]&&$(this).attr("id")!=s[0][0]){var t=i(e,$(this).attr("id"));o<t[0]&&(o=t[0],a=t[1])}}),void 0!=a)for(var l=0;l<e.length;l++)e[l][0]=a,x[e[l][1]][e[l][2]][0]=a;else{for(var d=t();d==O[0][0]||d==s[0][0];)d=t();for(var l=0;l<e.length;l++)e[l][0]=d,x[e[l][1]][e[l][2]][0]=d}$(".ai"+n).attr("class","power"),$("#"+e[0][0]).attr("class","power disabled ai"+n),r(e,"ai");for(var l=0;l<e.length;l++){var g=v(e[l][1],e[l][2]);u(g,e[l][1],e[l][2])}setTimeout(function(){for(var t=0;t<e.length;t++){var n=v(e[t][1],e[t][2]);h(n,e[t][1],e[t][2])}},300),c()}function a(){var e=x.length*x.length;return O.length>e-O.length-G.length&&O.length>e-O.length-D.length?(console.log("hai vinto"),s("WIN <br>"+O.length+":"+G.length+'<span id="aiscore">:'+D.length+"</span>","win"),$("body").addClass("gameover"),$("body").removeClass("gaming"),!0):G.length>e-G.length-D.length&&G.length>e-G.length-O.length||D.length>e-D.length-G.length&&D.length>e-D.length-O.length?(console.log("Ai ha vinto"),s("LOOSE <br>"+O.length+":"+G.length+'<span id="aiscore">:'+D.length+"</span>","reload"),$("body").addClass("gameover"),$("body").removeClass("gaming"),!0):!1}function i(e,t){for(var n=[],a=t,i=0;i<e.length;i++)e[i][2]<y-1&&x[e[i][1]][e[i][2]+1][0]==a&&-1==e.indexOf(x[e[i][1]][e[i][2]+1])&&n.push(x[e[i][1]][e[i][2]+1]),e[i][2]>0&&x[e[i][1]][e[i][2]-1][0]==a&&-1==e.indexOf(x[e[i][1]][e[i][2]-1])&&n.push(x[e[i][1]][e[i][2]-1]),e[i][1]>0&&x[e[i][1]-1][e[i][2]][0]==a&&-1==e.indexOf(x[e[i][1]-1][e[i][2]])&&n.push(x[e[i][1]-1][e[i][2]]),e[i][1]<y-1&&x[e[i][1]+1][e[i][2]][0]==a&&-1==e.indexOf(x[e[i][1]+1][e[i][2]])&&n.push(x[e[i][1]+1][e[i][2]]);return[n.length,t]}function r(e){for(var t=e[0][0],n=0;n<e.length;n++)e[n][2]<y-1&&x[e[n][1]][e[n][2]+1][0]==t&&-1==e.indexOf(x[e[n][1]][e[n][2]+1])&&e.push(x[e[n][1]][e[n][2]+1]),e[n][2]>0&&x[e[n][1]][e[n][2]-1][0]==t&&-1==e.indexOf(x[e[n][1]][e[n][2]-1])&&e.push(x[e[n][1]][e[n][2]-1]),e[n][1]>0&&x[e[n][1]-1][e[n][2]][0]==t&&-1==e.indexOf(x[e[n][1]-1][e[n][2]])&&e.push(x[e[n][1]-1][e[n][2]]),e[n][1]<y-1&&x[e[n][1]+1][e[n][2]][0]==t&&-1==e.indexOf(x[e[n][1]+1][e[n][2]])&&e.push(x[e[n][1]+1][e[n][2]])}function o(){w=setInterval(function(){changeGridDim()},3e3)}function s(e,t){$(".clickcounter").html(e),2==T?$("#aiscore").addClass("hide"):$("#aiscore").removeClass("hide"),$(".clickcounter").show(),$(".clickcounter").addClass("enabled"),$(".clickcounter").attr("id",t)}function l(e){$("body").addClass("pauseGrid"),$(".clickcounter").html(e),$(".clickcounter").show(),setTimeout(function(){$(".clickcounter").fadeOut()},900),setTimeout(function(){$("body").removeClass("pauseGrid")},1300)}function c(){$("#youCounter").html(O.length),$("#aiCounter").html(G.length>1?G.length:"0"),$("#ai2Counter").html(D.length>1?D.length:"0")}function d(){for(var e=0;y>e;e++)for(var t=0;y>t;t++){var n=$(".pixel:eq("+v(e,t)+")");n.attr("class","pixel "+x[e][t][0])}$(".pixel:eq(0)").attr("class","pixel you"),$(".pixel:eq("+(y*y-1)+")").attr("class","pixel ai"),2!=T&&$(".pixel:eq("+(y*y-y)+")").attr("class","pixel ai")}function h(e,t,n){var a=$(".pixel:eq("+e+")");a.attr("class","pixel "+x[t][n][0])}function u(e){var t=$(".pixel:eq("+e+")");t.attr("class","pixel black")}function g(){$(".pixel").each(function(){$(this).css({height:k,width:k})})}function f(e){return[e%y,y-1-parseInt(e/y)]}function v(e,t){var n=y*(y-1-t)+e;return n}function m(){y>=20&&$("#grid").addClass("small"),x=new Array(y);for(var e=0;y>e;e++)x[e]=new Array(y);for(var t=0;y>t;t++)for(var n=0;y>n;n++){var a=Math.floor(6*Math.random()+1);1==a&&(x[t][n]=["green",t,n]),2==a&&(x[t][n]=["yellow",t,n]),3==a&&(x[t][n]=["red",t,n]),4==a&&(x[t][n]=["blue",t,n]),5==a&&(x[t][n]=["orange",t,n]),6==a&&(x[t][n]=["violet",t,n])}}function p(){return navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i)?!0:!1}setTimeout(function(){$("body").addClass("noFb")},1e4);var w,C=!0;o();var b,y=5;p()?($("body").addClass("mobile"),b="touchstart"):($("body").addClass("desktop"),b="click");for(var x,k=100/y+"%",A=(Math.floor(y/2),Math.floor(y/2),1),O=[],G=[],D=[],T=2,M=0,q="<div class='pixel'></div>",B="",I=0;y>I;I++)for(var E=0;y>E;E++)B+=q;2==T&&$("#ai2CounterContainer").addClass("hide"),$("#grid").append(B),m(),d(),g(),changeGridDim(),c(),$("#start").click(function(){$("body").removeClass("infodisplayed"),changeGridDim(),$("body").addClass("gaming"),$("#levelcounter").html(""+A),O.push(x[0][y-1]),G.push(x[y-1][0]),2!=T&&D.push(x[0][0])}),$(".pixel").on(b,function(){var e=$(this).prevAll("div").length,t=f(e);0==t[0]&&t[1]==y-1?l("You start from here!"):t[0]==y-1&&0==t[1]?l("Ai starts from here!"):(C=!C,l(C?"Click the circles to change color!":"Collect more tiles than Ai!"))}),$(".clickcounter").on(b,function(){$(this).removeClass("enabled");var t=$(this).attr("id");$(".clickcounter").fadeOut(),"reload"==t&&window.location.reload(),"win"==t&&(M+=Math.ceil(2*A),e("win")),"draw"==t&&e("same"),$(".clickcounter").attr("id",""),2==T?$("#ai2CounterContainer").addClass("hide"):$("#ai2CounterContainer").removeClass("hide")}),$(".power").on(b,function(){$("#powers").addClass("wait"),$(".power").removeClass("mine"),$(this).attr("class","power mine");for(var e=0;e<O.length;e++)O[e][0]=$(this).attr("id"),x[O[e][1]][O[e][2]][0]=$(this).attr("id");r(O,"user");for(var e=0;e<O.length;e++){var t=v(O[e][1],O[e][2]);u(t,O[e][1],O[e][2])}setTimeout(function(){for(var e=0;e<O.length;e++){var t=v(O[e][1],O[e][2]);h(t,O[e][1],O[e][2])}},300),c();var i=a();setTimeout(function(){i||(n(G,1),i=a(),c())},1e3),2!=T&&setTimeout(function(){i||(n(D,2),a(),c())},2e3)})});